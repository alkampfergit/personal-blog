---
title: "Converting Visual Studio Macro to Visual Studio plugin"
description: ""
date: 2012-08-24T18:00:37+02:00
draft: false
tags: [Plugin,Visual Studio]
categories: [Visual Studio]
---
Visual Studio 2012 is really faster than 2010, this is due to an excellent work of the team to maximize performance and because in this release some of the older and less used part of the IDE were removed.  **One of this part is the Macro editor that is not anymore available in Visual Studio.** This is one of the feature I missed most because **I’ve used it in the past to automate some basic task, like** [**attach to IIS automatically with a keyboard shortcut**](http://www.codewrecks.com/blog/index.php/2011/08/17/macro-to-attach-to-local-iis-take-3/). The Macro engine had some limitation, it supported only Visual Basic, it was old code that needs time to be maintained and finally everything you can do with a Macro can be done with Visual Studio Plugin so there was no need to maintain anymore in the product.

 **If you used macro with VS2010 and you want to use them in VS2012 you need to** [**create an addin**](http://www.codewrecks.com/blog/index.php/2010/05/22/first-visual-studio-2010-addin/) **,** the easiest way is to go for a Visual Studio Package:

[![image](http://www.codewrecks.com/blog/wp-content/uploads/2012/08/image_thumb3.png "image")](http://www.codewrecks.com/blog/wp-content/uploads/2012/08/image3.png)

 ***Figure 1***: *Creating a Visual Studio Package*

Choosing a Project type of “[Visual Studio Package](http://www.codewrecks.com/blog/index.php/2012/01/09/customize-output-windows-in-visual-studio/)” will launch a wizard that asks you some information about the type of extension you want to create, the most important part is choosing the functions that the plugin want to implement, to convert a macro the simplest solution is implement one or more Commands.

[![image](http://www.codewrecks.com/blog/wp-content/uploads/2012/08/image_thumb4.png "image")](http://www.codewrecks.com/blog/wp-content/uploads/2012/08/image4.png)

 ***Figure 2***: *Choose to implement Menu Command.*

The default structure created by the wizard implements a simple command placed under the Tools menu, it can be invoked with the menu or you can assign shortcut to launch with a combination of keys. Once the project is created  **converting the macro is just a matter of copying the code of the macro inside the plugin and call inside the handler of the command**.

{{< highlight csharp "linenos=table,linenostart=1" >}}


Dte = Package.GetGlobalService(typeof(EnvDTE.DTE)) as DTE2;

// Add our command handlers for menu (commands must exist in the.vsct file)
_attachToIIS = new AttachToIIS(Dte);
OleMenuCommandService mcs = GetService(typeof(IMenuCommandService)) as OleMenuCommandService;
if (null != mcs)
{
    // Create the command for the menu item.
    CommandID menuCommandID = new CommandID(GuidList.guidAlkampferVsix2012CmdSet, (int)PkgCmdIDList.attachToIIS);
    MenuCommand menuItem = new MenuCommand(_attachToIIS.MenuItemCallback, menuCommandID);
    mcs.AddCommand(menuItem);
}

{{< / highlight >}}

This snippet of code is based on code generated by the wizard, I’ve only added line 1 to retrieve a reference to the DTE2 object needed by my AttachToIIS macro code and to keep the code clean I’ve moved all the code of the macro inside a dedicated class called AttachToIIS. This class has a method called MenuItemCallback that gots called when the user ask to execute the command (from the menu or from a shortcut).

 **I’ve then converted all of my old VB code to C# and pasted inside the class** , then press F5 and an instance of VS2012 Experimental Hive started, permitting me to debug the plugin to verify if everything is ok.

[![image](http://www.codewrecks.com/blog/wp-content/uploads/2012/08/image_thumb5.png "image")](http://www.codewrecks.com/blog/wp-content/uploads/2012/08/image5.png)

 ***Figure 3***: *My plugin is loaded correctly and the menu is there*

The icon is the default one used by the wizard it is an aspect I do not care about because I just want to use my old macro code :), now it is time to use Tools –&gt; Customize menu to assign a shortcut to this command.

[![image](http://www.codewrecks.com/blog/wp-content/uploads/2012/08/image_thumb6.png "image")](http://www.codewrecks.com/blog/wp-content/uploads/2012/08/image6.png)

 ***Figure 4***: *My new command is loaded and is associated to the Tools namespace, so it is called tools.AttachToIIS*

Et voilà, the game is done,  **the whole process of Macro Conversion took no more than 15 minutes**  **and I’m able to use the same macro code in VS2012. This is my feedback of the process**.

 **Advantages:** - Creating a VS package is a matter of few clicks and you have a solution completely configure to create your plugin
- The result is much more manageable, instead of having a bunch of macro code that you need to copy and paste inside the Macro IDE when you reinstall you have a vsix package that can be installed by everyone with a simple double click.
- You are not forced to use Visual Basic

 **Disadvantages:** - It is much simpler to experiment with macro, just write code, press F5 and you are immediately debugging the code, with a plugin when you press F5 another instance of VS starts, and it needs some seconds.

I’ll release the code the next week.

Gian Maria.
