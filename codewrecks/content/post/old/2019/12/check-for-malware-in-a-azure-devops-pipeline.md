---
title: "Check for Malware in a Azure DevOps Pipeline"
description: ""
date: 2019-12-14T09:00:37+02:00
draft: false
tags: [Security]
categories: [security]
---
In a previous post I’ve showed [Credential Scanner](http://www.codewrecks.com/blog/index.php/2019/11/23/quick-peek-at-microsoft-security-code-analysis-credential-scanner/), a special task part of [Microsoft Security Code Analysis](https://secdevtools.azurewebsites.net/) available in Azure, today  **I want to have a quick peek at** [**Anti Malware scanner task.**](https://secdevtools.azurewebsites.net/helpantimalware.html)

First of all a simple consideration: I’ve been asked several times if there is any need to have an AntiVirus or AntiMalware tools in build machines, after all the code that is build is developed by own developer, so there should be no need of such tools, right? In my opinion this is a false assumption, here is some quick consideration on how a malware can be downloaded in your build machine

1) If you build open source code where others can contribute and if there is no constant analysis of code, **it is simple for a malicious user to modify a script or yaml build to do something nasty to your build machine.** Ok, this is a really an edge case, but think at an angry employee that got fired and want to damage the company….

2) **Nuget, Npm and in general every package manager download stuff from internet, this should be enough to justify keeeping an AntiVirus on your build agent.** Some npm package you are using can be hijacked to download everything, and, generally speaking, everything can go south if you download stuff from the internet. I know that npm and nuget probably does some check of packages, but there is no real formal approval process, so I think that noone can guarantee that everything that comes from nuget, npm or the like is safe.

3) Custom Task in azure devops are also downloaded from the server, but in this situation the risk can be mitigated, because Microsoft checks product that are in marketplace.

> In my opinion, since a build agent will download stuff from internet and executes scripts made by humans, it is better to have a good security solution constantly monitoring Agent Working folder

 **Ok, point 2 is the real risk, to mitigate it, the only solution is to point to a private Nuget or Npm repositories, and double check every package that you allow from nuget.org or npm main repository.** The goal is: before a new version of a library is allowed to be used, someone should check if there are no risks. Npm is especially annoying, because an NPM install usually automatically updates libraries, this is why on a build you should always prefer npm ci instead of npm install.

Generally speaking, in my opinion it is better to have an antivirus on your build machine, and be 100% sure that agent folder and agent folder is constantly monitored.

 **To add an extra level of security, I’d also like to have a report in my build that certify that output of the build is safe, welcome Microsoft Malware Scanner Analyzer.** This is another task part of the [Microsoft Security Code Analysis](https://secdevtools.azurewebsites.net/) whose purpose is scanning a specific folder and report analysis in the build.

Task configuration is quite simple, you can usually leave all default configurations, and you are ready to go.

[![image](http://www.codewrecks.com/blog/wp-content/uploads/2019/12/image_thumb-8.png "image")](http://www.codewrecks.com/blog/wp-content/uploads/2019/12/image-8.png)

 ***Figure 1***: *Configuration of Malware scanner Task*

The only real parameter you want to configure is the  **path you want to scan, usually is the artifacts directory, so you are confident that the output of the build that will be uploaded to the service is Malware free.** Having another AntiVirus as I told before gives you double security, because standard antivirus kicks in automatically, and this task will do another check and upload result on the build.

[![image](http://www.codewrecks.com/blog/wp-content/uploads/2019/12/image_thumb-9.png "image")](http://www.codewrecks.com/blog/wp-content/uploads/2019/12/image-9.png)

 ***Figure 2***: *Output of Malware scanner in build output*

Call me paranoid, but I really like having an assurance that my artifacts are secure. I perfectly know that this is no 100% assumption that everything is good, but it is a good part to start.

Another nice aspect of the tool is that the output of the scan is also included as an artifacts.

[![image](http://www.codewrecks.com/blog/wp-content/uploads/2019/12/image_thumb-10.png "image")](http://www.codewrecks.com/blog/wp-content/uploads/2019/12/image-10.png)

 ***Figure 3***: *Anti malware scanner log uploaded as artifacts.*

This allows for everyone that downloads artifacts for installation to check output of the scanner.

Remember, when it is time for security, having a double check is better than have a single check.

Gian Maria
