---
title: "Dto generator and repository integration"
description: ""
date: 2009-07-31T02:00:37+02:00
draft: false
tags: [Programming,Software Architecture]
categories: [Programming,Software Architecture]
---
I have a project where I use repository pattern, interface code access domain object through a service, and the service return Dto. One of the bad side of the dto is that they are boring to write and to maintain. The main risk is that developers does this error

Mmmm I had to show a combo with all the typologies of the current customer, let me seee, I have already a service that return Typlogy object given the customer Id, ok Iâ€™ll use it. Can you spot the error???

The error is that the Typology object can contain (and in my situation is true) a lot of properties, some of them are long string, so the developer is retrieving a lot of unnecessary data from the service. The obvious solution is Dto, but noone wants to write them, so it is time to use code generation. With a T4 template Iâ€™m able to write stuff like this.

{{< highlight csharp "linenos=table,linenostart=1" >}}
    template = new DtoFactoryTemplate (  
        @"..\..\..\..\Common\Model\MyProject.Analyzer.Entities.Dll", 
        Path.GetDirectoryName(Host.TemplateFile),
        "MyProject.Entities.Analysis.Typology",
        "TypologyLinkDto",
        "MyProject.Service.Dto",
        "http://www.nablasoft.com",
        1, 
        new String[] {"Id", "Name", "CustomerId"},
        null,
        true, true, true);     
    template.RenderToFile(@"..\Dto\Generated\TypologyLinkDto.cs"); {{< / highlight >}}

<!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com -->

Ok it still needs to be cleaned a little, because a lot of the parameter are optional but it does the work, it generates this object.

[![image](http://www.codewrecks.com/blog/wp-content/uploads/2009/07/image-thumb27.png "image")](http://www.codewrecks.com/blog/wp-content/uploads/2009/07/image27.png)

It is a good DTO with the three property names I requested, now with Linq2Nhibernate and repository pattern I can write this service method.

{{< highlight CSharp "linenos=table,linenostart=1" >}}
public List<TypologyLinkDto> GetTipologiesLinkForCustomer(Int32 customerId)
{
    return Repository.Typology.Query(
        t => t.CustomerId == customerId,
        TypologyLinkDto.Assembler.ExpressionSelector);
}{{< / highlight >}}

<!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com -->

Thanks to autogenerated code I can use autogenerated Assembler.ExpressionSelector that can be passed as a selector function, resulting query is.

{{< highlight sql "linenos=table,linenostart=1" >}}
exec sp_executesql N'SELECT this_.kety_id as y0_, this_.kety_clieId as y1_, this_.kety_name as y2_ FROM KeyTypology this_ WHERE this_.kety_clieId = @p0',N'@p0 int',@p0=1{{< / highlight >}}

<!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com -->

This permits to speed up the application because now I retrieve only the data I needed from the database and nothing more, and the good part is that dto is autogenerated, so I can write this code in almost 20 seconds.

alk.

Tags: [Code Generation](http://technorati.com/tag/Code%20Generation)
